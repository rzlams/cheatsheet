<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>MySQL / Postgres Cheatsheet</title>
    <style>
        * {
            box-sizing: border-box;
            padding: 0;
            margin: 0;
        }

        table {
            width: 100%;
        }

        table,
        td,
        tr,
        th {
            border: 1px solid black;
            border-collapse: collapse;
            position: relative;
        }

        th {
            padding: .8em;
            text-transform: uppercase;
            background-color: darkblue;
            color: white;
        }

        tbody>tr:nth-child(odd) {
            background-color: white;
        }

        tbody>tr:nth-child(even) {
            background-color: lightblue;
        }

        td {
            padding: 1em;
            opacity: .6;
        }

        tbody td:hover {
            opacity: 1;
        }

        input {
            width: 25%;
            padding: .5em 0;
            margin-bottom: 1em;
        }

        tr>td:first-child {
            font-weight: bold;
            text-align: center;
            width: 10%;
        }

        tr>td:last-child {
            width: 35%;
        }

        img {
            width: 100%;
        }
    </style>
</head>

<body>
    <input type="search" id="inputCuenta" onkeyup="myFilterCuenta()" placeholder="Buscar por tecnologia">
    <input type="search" id="inputDetalle" onkeyup="myFilterDetalle()" placeholder="Buscar por sintaxis">

    <table>
        <thead>
            <tr>
                <th>Tecnologia</th>
                <th>Sintaxis</th>
                <th>Descripcion</th>
            </tr>
        </thead>
        <tbody id="cuentas">
            <tr>
                <td>MySQL</td>
                <td>
                    <b>0.- Crear proyecto en BOUML:</b> Menu "Project"->New; luego en el browser (con click derecho):
                    new class view->new class diagram->new class.<br /><br />
                    <b>1.- Definir entidades:</b> nombre y breve descripcion de cada una.<br /><br />
                    <b>2.- Definir relaciones:</b> incluyendo su cardinalidad minima y maxima.<br />
                    <b>* Cardinalidad minima:</b><br />
                    0 - la entidad se relaciona de manera opcional. Su existencia NO depende de participar en la relacion.<br />
                    1 - la entidad se relaciona de manera obligatorio. Su existencia SI depende de participar en la relacion.<br />
                    Ej: Una actividad (fuerte) NO necesita documento pero un documento (debil) SI una actividad.<br />
                    <b>* Cardinalidad maxima:</b><br />
                    1 - la ocurrencia puede relacionarse con solo una de la otra entidad.<br />
                    n - la ocurrencia puede relacionarse con varias a la vez.<br /><br />
                    <b>3.- Definir atributos:</b> pueden ser simples o compuestos. Se debe especificar cuales son
                    derivados (calculados a partir de otro).<br /><br />
                    <b>4.- Realizar el diagrama correspondiente al diseño logico</b><br />
                    * Si las entidades tienen PRIMARY KEY (PK) son llamadas "fuertes/padre" sino son llamadas
                    "debiles/hijo".<br />
                    * Cada ocurrencia de una entidad debil se relaciona con una y solamente una ocurrencia de la entidad
                    fuerte de la que depende. por esto en la entidad debil se debe crear una FOREIGN KEY (FK) enlazada a
                    la PK de la entidad fuerte.<br />
                    <b>- RELACIONES BINARIAS ENTRE ENTIDADES FUERTES: </b>en este tipo de relaciones la tabla hija
                    absorbe la relacion y se le asigna una FK.<br />
                    Segun la cardinalidad maxima de los atributos relacionados esta puede ser:<br />
                    <b>* Uno a uno:</b> la entidad hija es la que participa de manera oblogatoria, la que tiene
                    cardinalidad minima 1.<br />
                    <b>* Uno a muchos:</b> la entidad hija es la de cardinalidad maxima 1.<br />
                    <b>* Muchos a muchos:</b> se crea una tabla intermedia para almacenar las ocurrencias de la
                    relacion. Esta tabla contendra una FK a cada una de las tablas correspondientes a las entidades
                    participantes, ademas de incluir los atributos de la relacion. Ninguna de las FK aceptara nulos. La
                    PK de esta tabla seran las dos FK si la relacion no tiene atributos, o un atributo de la relacion
                    que pueda ser PK.<br />
                    En las relaciones "Uno a Uno" y "Uno a Muchos" tambien es posible usar una tabla intermedia, pero no
                    es obligatorio como en el caso "Muchos a Muchos". Esto se puede hacer para tratar de favorecer los
                    accesos mas frecuentes y/o que requieran un tiempo de respuesta menor.<br /><br />
                    <b>5.- Normalizacion</b>
                </td>
                <td>
                    WORKFLOW - CREACION DE BASE DE DATOS
                    <img class="imagen-descripcion" src="../images/diagramaUML.png" alt="diagrama UML de una BD" />
                    <br /><br /><br />
                    <b>Cardinalidad</b> => (minima, maxima)
                    <br /><br />
                    <b>Relaciones:</b><br />
                    actividades (0, *) <=> (1, 1) documentos<br />
                        - Una 'act' PUEDE no tener 'doc' o tener muchos<br />
                        - Un 'doc' DEBE estar asociado a una y solo una 'act'
                        <br /><br />
                        actividades (1, *) <=> (1, 1) tareas<br />
                            - Una 'act' DEBE estar asociada a una o mas 'tar'<br />
                            - Una 'tar' DEBE estar asociada a una y solo una 'act'
                            <br /><br />
                            grupos (0, *) <=> (1, 1) tareas<br />
                                - Un 'gr' PUEDE no tener 'tar' o tener muchas<br />
                                - Una 'tar' DEBE estar asociada a uno y solo un 'gr'
                                <br /><br />
                                grupos (1, *) <=> (1, 1) personas<br />
                                    - Un 'gr' DEBE estar asociado a una o mas 'per'<br />
                                    - Una 'per' DEBE estar asociada a uno y solo un 'gr'
                </td>
            </tr>
            <tr>
                <td>MySQL</td>
                <td>
                  mysql -u root -p  &nbsp; &nbsp; (/opt/lampp/bin ruta en xampp)<br/>
                  ALTER USER 'root'@'localhost' IDENTIFIED BY 'NEW_PASSWORD';
                </td>
                <td>
                  Abre la consola con el user y password especificados<br/>
                  Cambiar clave del usuario con el que entro en la consola (root en este caso)
                </td>
            </tr>
            <tr>
                <td>MySQL</td>
                <td>
                  SELECT COLUMN_NAME AS 'ColumnName'<br/>
                  ,TABLE_NAME AS  'TableName'<br/>
                  FROM INFORMATION_SCHEMA.COLUMNS<br/>
                  WHERE COLUMN_NAME LIKE '%country%'<br/>
                  ORDER BY TableName, ColumnName;
                </td>
                <td>
                  Buscar columnas y vistas en toda la DB segun el LIKE especificado
                </td>
            </tr>
            <tr>
                <td>MySQL</td>
                <td>
                    SELECT *<br />
                    FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE<br />
                    WHERE POSITION_IN_UNIQUE_CONSTRAINT IS NOT NULL
                </td>
                <td>
                    Muestra todas las FOREIGN KEY de la base de datos
                </td>
            </tr>
            <tr>
                <td>MySQL</td>
                <td>
                    USE ['nombre_base_de_datos'];
                </td>
                <td>
                    Asigna la Base de Datos con la que se quiere trabajar
                </td>
            </tr>
            <tr>
                <td>MySQL</td>
                <td>
                    DESCRIBE ['nombre_tabla'];
                </td>
                <td>
                    Muestra el nombre de los campos que conforman la tabla,
                    su tipo de dato, si admite nulos, cuales son PRIMARY KEY o FOREIGN KEY, su valor por defualt e info
                    extra (si es
                    auto_increment u otros)
                </td>
            </tr>
            <tr>
                <td>MySQL</td>
                <td>
                    SHOW Databases;<br />o<br />
                    SHOW Tables;
                </td>
                <td>
                    Muestra una lista con todas las Base de Datos almacenadas en el equipo<br />o<br />
                    Muestra una lista con los nombres de todas las tablas de la Base de Datos
                </td>
            </tr>
            <tr>
                <td>MySQL</td>
                <td>
                    ALTER TABLE [nombre_tabla_actual] RENAME TO [nuevo_nombre];
                </td>
                <td>
                    Cambia el nombre de una tabla
                </td>
            </tr>
            <tr>
                <td>MySQL</td>
                <td>
                    ALTER TABLE [nombre_tabla] CHANGE [nombre_actual_columna] [nuevo_nombre_columna][tipo de
                    dato][restriccion];
                </td>
                <td>
                    Cambia el nombre de una columna
                </td>
            </tr>
            <tr>
                <td>MySQL</td>
                <td>
                    ALTER TABLE [nombre_tabla] ADD CONSTRAINT [nombre_restriccion] [restriccion(columna_objetivo)];
                </td>
                <td>
                    Agrega una restriccion a una columna
                </td>
            </tr>
            <tr>
                <td>MySQL</td>
                <td>
                    NULLIF(valor1, valor2);
                </td>
                <td>
                    Si ambos valores son iguales devuelve nulo, sino devuelve el valor1
                </td>
            </tr>
            <tr>
                <td>MySQL</td>
                <td>
                    CREATE TABLE ['nombre_tabla'] (<br />
                    &nbsp; &nbsp; ['nombre_columna'] [tipo_dato] [constraint],<br />
                    &nbsp; &nbsp; CONSTRAINT ['nombre_pk'] PRIMARY KEY ([columna1], [columna2]),<br />
                    &nbsp; &nbsp; CONSTRAINT ['nombre_fk'] FOREIGN KEY ([columna1], [columna2])<br />
                    &nbsp; &nbsp; REFERENCES ['nombre_tabla_ref'](['nombre_columna_ref'])<br />
                    &nbsp; &nbsp; [MATCH FULL | MATCH PARTIAL]<br />
                    &nbsp; &nbsp; ON UPDATE [accion] ON DELETE [accion]<br />
                    )ENGINE=InnoDB;<br /><br /><br />

                    CREATE TABLE codventa_resets (<br />
                    &nbsp; &nbsp; id int AUTO_INCREMENT NOT NUll,<br />
                    &nbsp; &nbsp; idventa int NOT NUll,<br />
                    &nbsp; &nbsp; created_at timestamp DEFAULT CURRENT_TIMESTAMP,<br />
                    &nbsp; &nbsp; CONSTRAINT codventa_reset_pk PRIMARY KEY (id),<br />
                    &nbsp; &nbsp; CONSTRAINT ventas_fk FOREIGN KEY (idventa)<br />
                    &nbsp; &nbsp; REFERENCES ventas(idventa)<br />
                    &nbsp; &nbsp; ON UPDATE CASCADE ON DELETE CASCADE<br />
                    )ENGINE=InnoDB;
                </td>
                <td>
                    Si la FOREIGN KEY esta formada por varias columnas y admite nulos se puede establecer:<br /><br />
                    - MATCH FULL: todas las columnas de la FOREIGN KEY tienen valor o ninguna de ellas lo tiene.<br />
                    - MATCH PARTIAL: permite las FOREIGN KEY parcialmente nulas.<br /><br /><br />

                    Se pueden establecer 4 comportamientos [accion] para cada FOREIGN KEY cuando se borra o actualiza el
                    valor
                    referenciado, es decir, el valor original en la PRIMARY KEY:<br /><br />
                    - NO ACTION o RESTRICT: produce un error, no permite borrar ni actualizar.<br />
                    - CASCADE: borra/actualiza las filas que hacen referencia al valor borrado/actualizado.<br />
                    - SET NULL: pone un nulo en las filas donde se hacia referencia al valor borrado/actualizado.<br />
                    - SET DEFAULT: pone el valor por defecto en la filas donde se hacia referencia al valor
                    borrado/actualizado.
                </td>
            </tr>
            <tr>
                <td>MySQL</td>
                <td>
                    CREATE TRIGGER [nombre_trigger] [TIME] [EVENT]<br />
                    ON [nombre_tabla] FOR EACH ROW [NEW_STATEMENT];
                </td>
                <td>
                    <b>TIME</b> determina cuando se ejecuta la accion del trigger, puede ser:<br />
                    <b>BEFORE</b> ejecuta el trigger ANTES de la accion<br />
                    <b>AFTER</b> ejecuta el trigger DEPUES de la accion<br /><br />

                    <b>EVENT</b> es la accion que realiza el trigger, puede ser <b>UPDATE</b> o <b>DELETE</b> o
                    <b>INSERT</b><br /><br />

                    <b>NEW_STATEMENT</b> es la query que ejecutara el trigger. Ej: INSERT INTO, UPDATE, etc.<br /><br />

                    En el <b>NEW_STATEMENT</b> se debe especificar si usar el valor previo o posterior al ACTION. Para
                    ello se usan
                    los prefijos <b>"OLD."</b> (valor previo) y <b>"NEW."</b> (valor posterior) en los nombres de los
                    campos de la
                    tabla de origen de los datos, ya que son los que se asignan como valores.

                    <b>EACH ROW o EACH STATEMENT</b> (Averiguar que opciones hay)
                </td>
            </tr>
            <tr>
                <td>MySQL</td>
                <td>
                    DROP TRIGGER ['nombre_trigger'];
                </td>
                <td>
                    Borra el trigger seleccionado.
                </td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>sudo su - postgres</td>
                <td>Login con el usuario postgres, que es superusuario por defecto</td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>psql</td>
                <td>Entra a la consola postgres</td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>psql -U [nombre_usuario] [nombre_db]</td>
                <td>Accede a la base de datos con el usuario especificado</td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>\q</td>
                <td>Salir de la consola</td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>\h [comando]</td>
                <td>
                    Muestra la ayuda DENTRO de la consola para los comandos SQL.<br />
                    El [comando] es opcional.<br />
                    Presiona "q" para salir de la ayuda.
                </td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>\?</td>
                <td>
                    Muestra la ayuda DENTRO de la conexion a la consola.<br />
                    El [comando] es opcional.<br />
                    Presiona "q" para salir de la ayuda.
                </td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>psql --help</td>
                <td>Muestra la ayuda FUERA de la conexion a la consola</td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>\l</td>
                <td>Muestra la lista de las bases de datos</td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>\c [nombre_base_datos]</td>
                <td>
                    Conecta a la base de datos especificada.<br />
                    Con la ayuda FUERA de la conexion a la consola se puede ver como setear las opciones de la conexion.
                </td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>\d [nombre_tabla]</td>
                <td>
                    Describe la Base de Datos. Lista de Relaciones<br />
                    Con el [nombre_tabla] describe la tabla especificada.
                </td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>\du</td>
                <td>Muestra los usuarios</td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>pg_dump -U [nombre_usuario] [nombre_db] > [ruta_output].sql</td>
                <td>
                    Respalda la base de datos del usuario especificado en la ruta despues del mayor que.<br />
                    El archivo de output debe ser .sql
                </td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>pg_dumpall > /var/lib/pgsql/backups/dumpall.sql</td>
                <td>
                    Respalda todas las bases de datos.<br />
                    Debes estar logueado con el superusuario postgres. (sudo su - postgres)
                </td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>
                    psql -U postgres [database_name]
                    < [ruta_archivo].sql<br />
                    psql -f /var/lib/pgsql/backups/dumpall.sql [database_name]
                </td>
                <td>
                    Restaura la base de datos especificada<br />
                    Para el segundo comando debes estar logueado con el superusuario postgres. (sudo su - postgres)
                </td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>pg_restore --verbose --clean --no-acl --no-owner --host=[localhost] --dbname=[db_name]
                    --username=[username] [ruta_archivo].backup</td>
                <td>Restaura la base de datos especificada, para el usuario y host especificados</td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>sudo -u user_name psql db_name</td>
                <td>Password less login</td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>\i [ruta_archivo]</td>
                <td>
                    Inserta un archivo .sql
                </td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>SELECT version();</td>
                <td>Selecciona la version</td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>CREATE USER [nombre_usuario] WITH password '[password]'</td>
                <td>Crea un usuario para acceder a la conexion postgres</td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>ALTER USER [nombre_superuser] WITH SUPERUSER CREATEDB CREATEROLE INHERIT LOGIN REPLICATION</td>
                <td>Crea super usuario</td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>ALTER DATABASE [database_name] OWNER TO [new_owner];</td>
                <td>Cambiar el dueño de una base de datos</td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>DROP USER [nombre_usuario]</td>
                <td>Elimina un usuario para acceder a la conexion postgres</td>
            </tr>
            <tr>
                <td>PostgreSQL</td>
                <td>ALTER USER [usertochange] WITH password '[new_passwd]';</td>
                <td>
                    Resetea la contraseña de un usuario. Solo se puede hacer como administrador.
                </td>
            </tr>
        </tbody>
    </table>


    <script>

        function myFilterCuenta() {
            var tr, td, inputCuenta, filterCuenta,
                i, textValue;

            tr = document.getElementsByTagName("tr");
            inputCuenta = document.getElementById("inputCuenta");
            filterCuenta = inputCuenta.value.toUpperCase();

            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[0];

                if (td) {
                    textValue = td.textContent;
                    if (textValue.toUpperCase().indexOf(filterCuenta) > -1) {
                        tr[i].style.display = "";
                    } else { tr[i].style.display = "none"; }
                }
            }
        }
        function myFilterDetalle() {
            var tr, td, inputDetalle, filterDetalle,
                i, textValue;

            tr = document.getElementsByTagName("tr");
            inputDetalle = document.getElementById("inputDetalle");
            filterDetalle = inputDetalle.value.toUpperCase();

            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[1];

                if (td) {
                    textValue = td.textContent;
                    if (textValue.toUpperCase().indexOf(filterDetalle) > -1) {
                        tr[i].style.display = "";
                    } else { tr[i].style.display = "none"; }
                }
            }
        }

    </script>
</body>

</html>
